<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Moderno</title>
<style>
  body {
    margin: 0;
    background: #0f172a;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #topo {
    width: 100%;
    max-width: 420px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    box-sizing: border-box;
    font-size: 14px;
    gap: 6px;
  }

  #topo span { color: #a5f3fc; }

  #pauseBtn {
    background: #334155;
    border: none;
    color: #fff;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
  }

  canvas {
    width: 100vw;
    max-width: 420px;
    height: calc(100vh - 60px);
    max-height: 420px;
    background: #020617;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,.6);
    touch-action: none;
  }

  #overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(2,6,23,.85);
    z-index: 20;
  }

  #menu {
    text-align: center;
    width: 260px;
  }

  #menu h1 { margin-bottom: 10px; }
  #menu p { margin-bottom: 10px; color: #a5f3fc; }

  #menu select, #menu button {
    width: 100%;
    margin-top: 10px;
    padding: 12px;
    border-radius: 10px;
    border: none;
    font-size: 16px;
  }

  #menu button {
    background: #22c55e;
    color: #022c22;
    cursor: pointer;
  }

  .flash { animation: flash .15s; }
  @keyframes flash {
    from { background: #134e4a; }
    to   { background: #020617; }
  }

  /* CONTROLES */
  #controls {
  margin-top: 5px;
  display: grid;
  grid-template-columns: 110px 110px 110px;
  grid-template-rows: 92px 92px 92px;
  gap: 1px;
  justify-content: center;
}

.ctrl {
  background: #1e293b;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  user-select: none;
  touch-action: manipulation;
}


  .ctrl:active { background: #334155; }
  .empty { background: transparent; }
</style>
</head>
<body>

<div id="topo">
  <div>Tam: <span id="tamanho">1</span></div>
  <div>Nível: <span id="nivel">1</span></div>
  <div>Recorde: <span id="recorde">1</span></div>
  <button id="pauseBtn" onclick="togglePause()">⏸</button>
</div>

<div style="position:relative">
  <canvas id="game"></canvas>

  <div id="overlay">
    <div id="menu">
      <h1 id="titulo">Snake</h1>
      <p id="mensagem"></p>

      <select id="skinSelect">
        <option value="green">Verde</option>
        <option value="blue">Azul</option>
        <option value="neon">Neon</option>
        <option value="rainbow">Arco-íris</option>
      </select>

      <button onclick="startGame()">Play</button>
    </div>
  </div>
</div>

<div id="controls">
  <div class="empty"></div>
  <div class="ctrl" onclick="setDir(0,-1)">↑</div>
  <div class="empty"></div>

  <div class="ctrl" onclick="setDir(-1,0)">←</div>
  <div class="empty"></div>
  <div class="ctrl" onclick="setDir(1,0)">→</div>

  <div class="empty"></div>
  <div class="ctrl" onclick="setDir(0,1)">↓</div>
  <div class="empty"></div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  const size = Math.min(window.innerWidth, window.innerHeight - 70, 420);
  canvas.width = size;
  canvas.height = size;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

const cell = 18;
let snake, food, dir, loop, running = false, paused = false;
let speed = 150, level = 1, foodsEaten = 0, obstacles = [], skin = "green";

const tamanhoEl = document.getElementById("tamanho");
const nivelEl = document.getElementById("nivel");
const recordeEl = document.getElementById("recorde");
const overlay = document.getElementById("overlay");
const titulo = document.getElementById("titulo");
const mensagem = document.getElementById("mensagem");
const pauseBtn = document.getElementById("pauseBtn");
const controls = document.getElementById("controls");

let recorde = parseInt(localStorage.getItem("snakeRecorde") || "1");
recordeEl.textContent = recorde;

function cols() { return Math.floor(canvas.width / cell); }
function rows() { return Math.floor(canvas.height / cell); }

function reset() {
  const cx = Math.floor(cols() / 2);
  const cy = Math.floor(rows() / 2);
  snake = [{x: cx, y: cy}];
  dir = {x: 1, y: 0};
  speed = 150; level = 1; foodsEaten = 0; obstacles = [];
  spawnFood();
  tamanhoEl.textContent = 1;
  nivelEl.textContent = level;
  mensagem.textContent = "";
  titulo.textContent = "Snake";
  paused = false;
  pauseBtn.textContent = "⏸";
}

function spawnFood() {
  let valid = false;
  while (!valid) {
    const pos = { x: Math.floor(Math.random()*cols()), y: Math.floor(Math.random()*rows()) };
    valid = !snake.some(p=>p.x===pos.x&&p.y===pos.y) &&
            !obstacles.some(o=>o.x===pos.x&&o.y===pos.y);
    if (valid) food = pos;
  }
}

function startGame() {
  resizeCanvas();
  skin = document.getElementById("skinSelect").value;
  reset();
  overlay.style.display = "none";
  controls.style.display = "grid";
  running = true;
  startLoop();
}

function startLoop() {
  clearInterval(loop);
  loop = setInterval(update, speed);
}

function togglePause() {
  if (!running) return;
  paused = !paused;
  pauseBtn.textContent = paused ? "▶" : "⏸";
}

function gameOver() {
  running = false;
  clearInterval(loop);
  titulo.textContent = "Game Over";
  mensagem.textContent = `Você chegou ao nível ${level}`;
  if (level > recorde) {
    recorde = level;
    localStorage.setItem("snakeRecorde", recorde);
    recordeEl.textContent = recorde;
  }
  overlay.style.display = "flex";
  controls.style.display = "none";
}

function createObstacles() {
  obstacles = [];
  for (let i=0;i<6;i++)
    obstacles.push({x:Math.floor(Math.random()*cols()),y:Math.floor(Math.random()*rows())});
}

function setDir(x,y){
  if (!running) return;
  if (x !== 0 && dir.x === 0) dir = {x,y};
  if (y !== 0 && dir.y === 0) dir = {x,y};
}

function update() {
  if (paused) return;
  const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

  if (head.x < 0) head.x = cols()-1;
  if (head.x >= cols()) head.x = 0;
  if (head.y < 0) head.y = rows()-1;
  if (head.y >= rows()) head.y = 0;

  if (snake.some(p=>p.x===head.x&&p.y===head.y)) return gameOver();
  if (obstacles.some(o=>o.x===head.x&&o.y===head.y)) return gameOver();

  snake.unshift(head);

  if (head.x === food.x && head.y === food.y) {
    spawnFood(); foodsEaten++; tamanhoEl.textContent = snake.length;
    canvas.classList.remove("flash"); void canvas.offsetWidth; canvas.classList.add("flash");

    if (foodsEaten % 3 === 0) {
      level++; nivelEl.textContent = level;
      speed = Math.max(70, speed - 8);
      startLoop();
      if (level === 5) createObstacles();
    }
  } else snake.pop();

  draw();
}

function snakeColor(i) {
  if (skin === "blue") return i === 0 ? "#60a5fa" : "#2563eb";
  if (skin === "neon") return i === 0 ? "#a78bfa" : "#22d3ee";
  if (skin === "rainbow") return `hsl(${(i*25)%360},100%,60%)`;
  return i === 0 ? "#22c55e" : "#16a34a";
}

function draw() {
  ctx.fillStyle = "#020617";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  for (let o of obstacles) {
    ctx.fillStyle = "#ef4444";
    ctx.fillRect(o.x*cell,o.y*cell,cell-1,cell-1);
  }

  for (let i=0;i<snake.length;i++) {
    ctx.fillStyle = snakeColor(i);
    ctx.fillRect(snake[i].x*cell,snake[i].y*cell,cell-1,cell-1);
  }

  ctx.fillStyle = "#f97316";
  ctx.beginPath();
  ctx.arc(food.x*cell+cell/2, food.y*cell+cell/2, cell/2-2, 0, Math.PI*2);
  ctx.fill();
}
</script>

</body>
</html>
